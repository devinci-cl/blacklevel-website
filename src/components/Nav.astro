---
type NavKey = 'home' | 'que-hacemos' | 'como-lo-hacemos' | 'quienes-somos' | 'portafolio';
type ActiveNavKey = NavKey | 'contacto';

interface Props {
	active: ActiveNavKey;
}

const { active } = Astro.props as Props;

const links: Array<{ href: string; label: string; key: NavKey }> = [
	{ href: '/', label: 'HOME', key: 'home' },
	{ href: '/que-hacemos', label: 'QUÉ HACEMOS', key: 'que-hacemos' },
	{ href: '/como-lo-hacemos', label: 'CÓMO LO HACEMOS', key: 'como-lo-hacemos' },
	{ href: '/quienes-somos', label: 'NOSOTROS', key: 'quienes-somos' },
	{ href: '/portafolio', label: 'PORTAFOLIO', key: 'portafolio' },
];

const isContactActive = active === 'contacto';
const desktopLinkBase = 'text-xs font-medium tracking-wide transition-colors duration-300';
const mobileLinkBase = 'flex items-center justify-between rounded-2xl px-4 py-3 border text-xs font-semibold uppercase tracking-wide transition-all duration-200';
---

<nav id="nav" class="fixed top-0 w-full z-50 backdrop-blur-2xl bg-black/40 border-b border-white/10 shadow-2xl">
	<div class="max-w-7xl mx-auto px-6 md:px-8 py-4 md:py-5 flex items-center justify-between">
		<a href="/" class="text-2xl font-bold text-white tracking-tighter">
			<span class="text-white">B l a c k l e v e l</span>
		</a>
		<div class="flex items-center gap-4">
			<button 
				id="mobile-toggle"
				type="button"
				class="md:hidden inline-flex h-11 w-11 items-center justify-center rounded-full border border-white/20 text-white/80 hover:text-white hover:border-white/50 transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70"
				aria-label="Abrir menú"
				aria-expanded="false"
			>
				<span class="sr-only">Abrir menú</span>
				<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
					<path d="M4 7h16" />
					<path d="M4 12h16" />
					<path d="M4 17h16" />
				</svg>
			</button>
			<ul class="hidden md:flex gap-8 items-center">
				{links.map(({ href, label, key }) => {
					const isActive = key === active;
					return (
						<li>
							<a 
								href={href} 
								class={`${desktopLinkBase} ${isActive ? 'text-white' : 'text-gray-400 hover:text-white'}`} 
								aria-current={isActive ? 'page' : undefined}
							>
								{label}
							</a>
						</li>
					);
				})}
				<li>
					<a 
						href="/contacto" 
						class={`relative bg-white text-black px-6 py-2.5 rounded-full text-xs font-bold tracking-wide transition-all duration-300 shadow-lg shadow-white/20 hover:shadow-xl hover:shadow-white/30 hover:scale-105 ${isContactActive ? 'ring-2 ring-white/70' : 'hover:bg-gray-100'}`}
						aria-current={isContactActive ? 'page' : undefined}
					>
						CONTACTO
					</a>
				</li>
			</ul>
		</div>
	</div>

	<div 
		id="mobile-menu" 
		class="md:hidden fixed inset-x-0 top-20 px-6 pb-10 bg-black/95 border-t border-white/10 backdrop-blur-2xl z-40 transition-all duration-300 opacity-0 pointer-events-none -translate-y-2"
	>
		<div class="pt-4 space-y-6 max-h-[calc(100vh-7rem)] overflow-y-auto">
			<ul class="flex flex-col gap-3">
				{links.map(({ href, label, key }) => {
					const isActive = key === active;
					return (
						<li>
							<a
								href={href}
								data-mobile-nav-link
								class={`${mobileLinkBase} ${isActive ? 'border-white/70 text-white bg-white/5 shadow-lg shadow-white/10' : 'border-white/10 text-gray-300 hover:border-white/40 hover:text-white'}`}
								aria-current={isActive ? 'page' : undefined}
							>
								<span>{label}</span>
								<svg class="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
									<path d="M9 6l6 6-6 6" />
								</svg>
							</a>
						</li>
					);
				})}
			</ul>
			<a 
				href="/contacto" 
				data-mobile-nav-link
				class={`block text-center bg-white text-black px-6 py-3.5 rounded-full text-sm font-bold tracking-wide transition-all duration-300 shadow-xl shadow-white/20 hover:shadow-2xl hover:shadow-white/30 hover:scale-105 ${isContactActive ? 'ring-2 ring-white/70' : ''}`}
				aria-current={isContactActive ? 'page' : undefined}
			>
				CONTACTO
			</a>
		</div>
	</div>
</nav>

<script>
	const mobileToggle = document.getElementById('mobile-toggle');
	const mobileMenu = document.getElementById('mobile-menu');
	let isMenuOpen = false;

	const setMobileMenuState = (open) => {
		if (!mobileMenu || !mobileToggle) return;
		isMenuOpen = open;
		mobileMenu.classList.toggle('opacity-0', !open);
		mobileMenu.classList.toggle('-translate-y-2', !open);
		mobileMenu.classList.toggle('pointer-events-none', !open);
		mobileToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
		document.body.classList.toggle('overflow-hidden', open);
	};

	if (mobileToggle && mobileMenu) {
		setMobileMenuState(false);

		mobileToggle.addEventListener('click', () => {
			setMobileMenuState(!isMenuOpen);
		});

		mobileMenu.querySelectorAll('[data-mobile-nav-link]').forEach((link) => {
			link.addEventListener('click', () => setMobileMenuState(false));
		});

		window.addEventListener('resize', () => {
			if (window.innerWidth >= 768 && isMenuOpen) {
				setMobileMenuState(false);
			}
		});
	}
</script>
