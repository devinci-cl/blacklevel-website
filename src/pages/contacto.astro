---
import '../styles/global.css';
import Nav from '../components/Nav.astro';
---

<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Contacto - Blacklevel</title>
	</head>
	<body class="bg-black min-h-screen overflow-x-hidden">
		<!-- Navegaci贸n -->
		<Nav active="contacto" />

		<!-- Contenido -->
		<section class="min-h-screen pt-32 pb-20">
			<div class="max-w-5xl mx-auto px-6">
				<h1 id="title" class="text-6xl md:text-7xl font-bold text-white mb-8 tracking-tight">
					Contacto
				</h1>
				<p id="subtitle" class="text-2xl text-gray-400 font-light mb-16 max-w-3xl">
					驴Tienes un proyecto en mente? Hablemos y hag谩moslo realidad.
				</p>
				
				<div id="contact-content" class="grid md:grid-cols-2 gap-12">
					<!-- Formulario -->
					<div class="form-container">
						<form id="contact-form" class="space-y-6">
							<div>
								<label for="name" class="block text-sm font-medium text-gray-400 mb-2">Nombre</label>
								<input 
									type="text" 
									id="name" 
									name="name" 
									required
									class="w-full px-4 py-3 bg-gray-900 border border-gray-800 rounded-lg text-white focus:outline-none focus:border-white transition-colors"
									placeholder="Tu nombre"
								/>
								<p id="name-error" class="text-red-400 text-xs mt-1 hidden">El nombre es requerido</p>
							</div>

							<div>
								<label for="email" class="block text-sm font-medium text-gray-400 mb-2">Email</label>
								<input 
									type="email" 
									id="email" 
									name="email" 
									required
									class="w-full px-4 py-3 bg-gray-900 border border-gray-800 rounded-lg text-white focus:outline-none focus:border-white transition-colors"
									placeholder="tu@email.com"
								/>
								<p id="email-error" class="text-red-400 text-xs mt-1 hidden">El email es requerido y debe ser v谩lido</p>
							</div>

							<div>
								<label for="message" class="block text-sm font-medium text-gray-400 mb-2">Mensaje</label>
								<textarea 
									id="message" 
									name="message" 
									rows="5"
									required
									class="w-full px-4 py-3 bg-gray-900 border border-gray-800 rounded-lg text-white focus:outline-none focus:border-white transition-colors resize-none"
									placeholder="Cu茅ntanos sobre tu proyecto..."
								></textarea>
								<p id="message-error" class="text-red-400 text-xs mt-1 hidden">El mensaje es requerido</p>
							</div>

							<button 
								type="submit"
								id="submit-btn"
								class="w-full bg-white text-black px-8 py-4 rounded-full font-semibold hover:bg-gray-200 transition-all duration-200 shadow-lg"
							>
								Enviar mensaje
							</button>
						</form>
					</div>

					<!-- Info -->
					<div class="info-container space-y-8">
						<div class="contact-info">
							<h3 class="text-2xl font-bold text-white mb-4">Informaci贸n de contacto</h3>
							<div class="space-y-4 text-gray-400">
								<p class="flex items-start gap-3">
									<span class="text-white"></span>
									<span>Operaciones@blackelevel.cl</span>
								</p>
								<p class="flex items-start gap-3">
									<span class="text-white"></span>
									<span>+56992148404</span>
								</p>
								<p class="flex items-start gap-3">
									<span class="text-white"></span>
									<span>Apoquindo 7430</span>
								</p>
							</div>
						</div>

						<!-- <div class="hours">
							<h3 class="text-2xl font-bold text-white mb-4">Horario</h3>
							<div class="space-y-2 text-gray-400">
								<p>Lunes - Viernes: 9:00 - 18:00</p>
								<p>S谩bado: 10:00 - 14:00</p>
								<p>Domingo: Cerrado</p>
							</div>
						</div> -->

						<!-- <div class="social">
							<h3 class="text-2xl font-bold text-white mb-4">S铆guenos</h3>
							<div class="flex gap-4">
								<a href="#" class="w-12 h-12 bg-gray-900 border border-gray-800 rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors">
									<span class="text-white">in</span>
								</a>
								<a href="#" class="w-12 h-12 bg-gray-900 border border-gray-800 rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors">
									<span class="text-white">tw</span>
								</a>
								<a href="#" class="w-12 h-12 bg-gray-900 border border-gray-800 rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors">
									<span class="text-white">ig</span>
								</a>
							</div>
						</div> -->
					</div>
				</div>
			</div>
		</section>

		<!-- Bot贸n flotante de WhatsApp -->
		<a 
			href="https://wa.me/56992148404?text=Hola,%20quiero%20m%C3%A1s%20informaci%C3%B3n%20sobre%20sus%20servicios" 
			target="_blank"
			rel="noopener noreferrer"
			id="whatsapp-btn"
			class="fixed bottom-8 right-8 bg-gradient-to-br from-green-400 to-green-600 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-2xl shadow-green-500/30 hover:shadow-green-500/50 hover:from-green-500 hover:to-green-700 transition-all duration-300 hover:scale-110 z-50 border border-green-400/20"
			aria-label="Contactar por WhatsApp"
		>
			<svg class="w-8 h-8 drop-shadow-lg" fill="currentColor" viewBox="0 0 24 24">
				<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
			</svg>
		</a>
	</body>
</html>

<script>
	import { gsap } from 'gsap';

	gsap.fromTo('#nav', 
		{ y: -100, opacity: 0 },
		{ y: 0, opacity: 1, duration: 0.8, ease: 'power3.out' }
	);

	gsap.fromTo('#title',
		{ opacity: 0, y: 30 },
		{ opacity: 1, y: 0, duration: 0.8, delay: 0.2, ease: 'power2.out' }
	);

	gsap.fromTo('#subtitle',
		{ opacity: 0, y: 20 },
		{ opacity: 1, y: 0, duration: 0.8, delay: 0.4, ease: 'power2.out' }
	);

	gsap.fromTo('.form-container',
		{ opacity: 0, x: -30 },
		{ opacity: 1, x: 0, duration: 0.8, delay: 0.6, ease: 'power2.out' }
	);

	gsap.fromTo('.info-container',
		{ opacity: 0, x: 30 },
		{ opacity: 1, x: 0, duration: 0.8, delay: 0.6, ease: 'power2.out' }
	);

	// Validaci贸n del formulario
	const contactForm = document.getElementById('contact-form');
	const nameInput = document.getElementById('name') as HTMLInputElement;
	const emailInput = document.getElementById('email') as HTMLInputElement;
	const messageInput = document.getElementById('message') as HTMLTextAreaElement;
	const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

	const nameError = document.getElementById('name-error');
	const emailError = document.getElementById('email-error');
	const messageError = document.getElementById('message-error');

	// Funci贸n para validar email
	function isValidEmail(email: string): boolean {
		const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
		return emailRegex.test(email);
	}

	// Funci贸n para mostrar error
	function showError(errorElement: HTMLElement | null, inputElement: HTMLElement) {
		if (errorElement) {
			errorElement.classList.remove('hidden');
		}
		inputElement.classList.add('border-red-500');
		inputElement.classList.remove('border-gray-800');
	}

	// Funci贸n para ocultar error
	function hideError(errorElement: HTMLElement | null, inputElement: HTMLElement) {
		if (errorElement) {
			errorElement.classList.add('hidden');
		}
		inputElement.classList.remove('border-red-500');
		inputElement.classList.add('border-gray-800');
	}

	// Validaci贸n en tiempo real
	nameInput?.addEventListener('blur', () => {
		if (!nameInput.value.trim()) {
			showError(nameError, nameInput);
		} else {
			hideError(nameError, nameInput);
		}
	});

	emailInput?.addEventListener('blur', () => {
		if (!emailInput.value.trim()) {
			showError(emailError, emailInput);
		} else if (!isValidEmail(emailInput.value)) {
			if (emailError) {
				emailError.textContent = 'El email no es v谩lido';
				showError(emailError, emailInput);
			}
		} else {
			hideError(emailError, emailInput);
		}
	});

	messageInput?.addEventListener('blur', () => {
		if (!messageInput.value.trim()) {
			showError(messageError, messageInput);
		} else {
			hideError(messageError, messageInput);
		}
	});

	// Validaci贸n al enviar el formulario
	contactForm?.addEventListener('submit', async (e) => {
		e.preventDefault();

		let isValid = true;

		// Validar nombre
		if (!nameInput.value.trim()) {
			showError(nameError, nameInput);
			isValid = false;
		} else {
			hideError(nameError, nameInput);
		}

		// Validar email
		if (!emailInput.value.trim()) {
			if (emailError) {
				emailError.textContent = 'El email es requerido y debe ser v谩lido';
			}
			showError(emailError, emailInput);
			isValid = false;
		} else if (!isValidEmail(emailInput.value)) {
			if (emailError) {
				emailError.textContent = 'El email no es v谩lido';
			}
			showError(emailError, emailInput);
			isValid = false;
		} else {
			hideError(emailError, emailInput);
		}

		// Validar mensaje
		if (!messageInput.value.trim()) {
			showError(messageError, messageInput);
			isValid = false;
		} else {
			hideError(messageError, messageInput);
		}

		// Si es v谩lido, proceder con el env铆o
		if (isValid) {
			// Deshabilitar bot贸n mientras se env铆a
			submitBtn.disabled = true;
			submitBtn.textContent = 'Enviando...';

			try {
				const response = await fetch('/api/contact', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({
						name: nameInput.value.trim(),
						email: emailInput.value.trim(),
						message: messageInput.value.trim(),
					}),
				});

				const result = await response.json();

				if (response.ok) {
					alert('隆Mensaje enviado con 茅xito! Nos pondremos en contacto contigo pronto.');
					contactForm.reset();
				} else {
					alert(result.error || 'Error al enviar el mensaje. Intenta nuevamente.');
				}
			} catch (err) {
				console.error('Error:', err);
				alert('Error al enviar el mensaje. Intenta nuevamente.');
			} finally {
				submitBtn.disabled = false;
				submitBtn.textContent = 'Enviar mensaje';
			}
		} else {
			// Hacer scroll al primer error
			const firstError = document.querySelector('.border-red-500');
			if (firstError) {
				firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
			}
		}
	});
</script>
